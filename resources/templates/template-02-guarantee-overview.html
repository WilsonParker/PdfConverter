<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Template 02. 보장 현황</title>
    <!--<link rel="stylesheet" href="/resources/styles/print.css" />-->
    {{ styleComponents | safe}}
    <style>
      /* 전체 영역 */
      .guarantee-container {
        display: flex;
        width: 100%;
        border-top: 1px solid var(--color-primary);
        align-items: flex-start;
      }

      /* 왼쪽 전체 보험 영역*/
      .sidebar-fixed {
        width: 280px;
        flex-shrink: 0;
      }
      /* 왼쪽 헤더 전체 요약 영역*/
      .header-summary-box {
        background: var(--color-primary);
        border-right: 1px solid var(--color-primary);
        padding: 18px;
        height: 134px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
      }

      .summary-inner {
        background: var(--color-white);
        width: 100%;
        height: 100%;
        padding: 0 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        border-radius: 0;
        box-sizing: border-box;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        width: 100%;
      }

      .summary-item-first {
        margin-bottom: 10px;
      }
      .summary-item-second {
        border-top: 1px solid var(--color-primary);
        padding-top: 10px;
      }
      .summary-item .label {
        font-size: 10px;
        font-weight: 600;
        width: 80px;
        text-align: left;
      }
      .summary-item-first .label {
        width: 50px;
      }
      .summary-item .value {
        font-size: 16px;
        font-weight: 600;
        text-align: right;
      }

      /* 오른쪽 보험 전체 영역*/
      .content-dynamic {
        flex: 1;
        overflow-x: hidden;
      }

      /* 우측 헤더 동적 영역 */
      .contract-header-row {
        display: flex;
        height: 134px;
      }
      /* 계약 헤더 칼럼 설정 */
      .contract-col {
        flex: 1;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
        border-right: 1px solid var(--color-primary-op5);
        border-bottom: 1.5px solid var(--color-primary);
        text-align: center;
        overflow: hidden;
      }
      .contract-col:last-child {
        border-right: none;
      }
      .contract-col li {
        display: flex;
        align-items: center;
        text-align: left;
        flex: 1 1 0;
        width: 100%;
        padding: 0 8px;
        box-sizing: border-box;
      }
      /* 1. 롯데손보 */
      .contract-company {
        font-size: 10px;
      }
      /* 2. 상품명 무배당 */
      .col-prod {
        background: var(--color-primary-op8);
        color: #fff;
        height: 45px;
        font-size: 10px;
        display: flex;
        flex: none !important;
      }
      /* 3. 납기 정보 */
      .contract-meta {
        font-size: 10px;
        border-bottom: 1px solid var(--color-primary-op5);
        justify-content: flex-end;
      }
      /* 4. 기간 정보 */
      .contract-date {
        font-size: 10px;
        justify-content: flex-end;
      }
      /* 5. 보험료 */
      .col-premium {
        background: var(--color-primary-op1);
        display: flex;
        font-size: 12px;
        font-weight: 600;
        justify-content: flex-end;
      }

      /* 테이블 설정 (table-layout: fixed 필수) */
      .guarantee-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        border-right: 1px solid var(--color-primary-op5);
      }
      .guarantee-table tr {
        height: 22px;
      }
      .guarantee-table td {
        border-bottom: 1px solid var(--color-primary-op5);
        border-right: 1px solid var(--color-primary-op5);
        vertical-align: middle;
        box-sizing: border-box;
      }

      /* 테이블 5개 그룹 끝 행 설정 */
      .row-group-end td {
        border-bottom: 1.5px solid var(--color-primary) !important;
      }

      /* <<<< 왼쪽 테이블 설정 */
      #dynamic-table-root {
        border-right: none;
      }
      /* 사망 상해 그룹 설정 */
      .col-group {
        background: var(--color-primary-op1);
        text-align: center;
        font-weight: 600;
        font-size: 12px;
        border-bottom: 1.5px solid var(--color-primary) !important;
        width: 50px;
      }
      /* 보장 항목 설정 */
      .col-name {
        padding: 0 4px;
        width: 140px;
        font-size: 12px;
      }
      /* 월 보험료 합계 설정 */
      .col-total {
        background: var(--color-secondary-op5);
        text-align: right;
        padding: 0 8px;
        font-weight: 600;
        width: 90px;
        font-size: 10px;
      }

      /* >>> 오른쪽 테이블 설정 */
      .guarantee-table td:last-child {
        border-right: none;
      }
      /* 오른쪽 테이블 합계 설정 */
      .cell-amt {
        text-align: right;
        padding: 0 8px;
        font-weight: 600;
        font-size: 10px;
      }
    </style>
  </head>
  <body>
    <div class="page" data-id="template-02-guarantee-overview">
      <div class="guarantee-container">
        <div class="sidebar-fixed">
          <div class="header-summary-box">
            <div class="summary-inner">
              <div class="summary-item summary-item-first">
                <span class="label">보험 계약</span>
                <span class="value">{{ data.number_of_insurance_contracts }}<small> 건</small></span>
              </div>
              <div class="summary-item summary-item-second">
                <span class="label">월 보험료 합계</span>
                <div class="value">{{ data.monthly_insurance_premium }}</span><small> 원</small></div>
              </div>
            </div>
          </div>
          <table class="guarantee-table">
            <colgroup>
              <col class="col-group-col" />
              <col class="col-name-col" />
              <col class="col-total-col" />
            </colgroup>
            <!-- fixed-sidebar-body -->
            <tbody data-id="fixed-sidebar-body">
            {% for group in data.tables %}
              {% set rowCount = group['items'] | length %}
              {% for item in group['items'] %}
              <tr class="{{ 'row-group-end' if loop.last else '' }}">
                {% if loop.first %}
                <td class="col-group" rowspan="{{ rowCount }}">
                  {{ group.groupName | replace('\n', '<br>') | safe }}
                </td>
                {% endif %}
                <td class="col-name">{{ item.name }}</td>
                <td class="col-total">{{ item.total }}</td>
              </tr>
              {% endfor %}
            {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="content-dynamic">
          <!-- dynamic-header-row -->
          <div class="contract-header-row" data-id="dynamic-header-row">
            {% for c in data.headerTables %}
              <ul class="contract-col">
                  <li class="contract-company">{{ c.company_name }}</li>
                  {# replace 문법: | replace('바꿀문자', '새문자') | safe #}
                  <li class="col-prod">{{ c.product_name | replace('\n', '<br>') | safe }}</li>
                  <li class="contract-meta">{{ c.payment_maturity_str }}</li>
                  <li class="contract-date">{{ c.payment_maturity_date }}</li>
                  <li class="col-premium">{{ c.monthly_premium }}</li>
              </ul>
            {% endfor %}

            {# 2. 데이터가 4개 미만일 경우 빈 칼럼 추가 #}
            {# range(현재개수, 목표개수) #}
            {% for _ in range(data.headerTables | length, 4) %}
              <ul class="contract-col empty-col">
                <li class="contract-company">-</li>
                <li class="col-prod"></li>
                <li class="contract-meta"></li>
                <li class="contract-date"></li>
                <li class="col-premium"></li>
              </ul>
            {% endfor %}
          </div>
          <table class="guarantee-table" id="dynamic-table-root">
            <!-- dynamic-content-body -->
            <tbody data-id="dynamic-content-body">
              {% for group in data.tables %}
                {% for item in group['items'] %}
                  <tr class="{{ 'row-group-end' if loop.last else '' }}">
                    {% for subItem in item['items'] %}
                      <td class="cell-amt">{{ subItem }}</td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      ((data) => {
        const renderTemplate = () => {
              // 4. 너비 정렬 핵심: 우측 테이블에 colgroup 삽입 (계약 개수 비례)
              const colWidth = 100 / contracts.length;
              const colGroupHtml = `<colgroup>${contracts
                .map(() => `<col style="width: ${colWidth}%">`)
                .join("")}</colgroup>`;
              document
                .getElementById("dynamic-table-root")
                .insertAdjacentHTML("afterbegin", colGroupHtml);
            };
            renderTemplate();
      })();
    </script>
  </body>
</html>
